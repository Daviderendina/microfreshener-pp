description: robot-shop-v2
imports:
- {micro: 'https://di-unipi-socc.github.io/microTOSCA/1.1/microTOSCA.yaml'}
topology_template:
  groups:
    edge:
      members:
      - MR56-store.default.svc
      - S1-orders.orders.default.deploy
      - S7-login.login.default
      - S4-supplier.supplier.default.pod
      type: micro.groups.Edge
  node_templates:
    S1-orders.orders.default.deploy:
      type: micro.nodes.Service
      requirements:
        - {interaction: S8-mysql-catalogue.catalogue.default.sts}
        - {interaction: MR3-warehouse.default.svc}
        - {interaction: MR2-users.default.svc}
    S2-users.users.default:
      type: micro.nodes.Service
      requirements:
        - interaction: Si10-mysql.users-db.default.pod
    S3-warehouse.warehouse-rs.default:
      type: micro.nodes.Service
      requirements:
        - {interaction: S4-supplier.supplier.default.pod}
    S4-supplier.supplier.default.pod:
      type: micro.nodes.Service
    S5-e-commerce.store.default.deploy:
      type: micro.nodes.Service
      requirements:
        - {interaction: MR1-orders.default.svc}
    S6-shop.store.default:
      type: micro.nodes.Service
      requirements:
        - {interaction: MR1-orders.default.svc}
    S7-login.login.default:
      type: micro.nodes.Service
      requirements:
        - {interaction: MR2-users.default.svc}
    S8-mysql-catalogue.catalogue.default.sts:
      type: micro.nodes.Service
    Si10-mysql.users-db.default.pod:
      type: micro.nodes.Service

    MR1-orders.default.svc:
      type: micro.nodes.MessageRouter
      requirements:
        - {interaction: S1-orders.orders.default.deploy}
    MR2-users.default.svc:
      type: micro.nodes.MessageRouter
      requirements:
        - {interaction: S2-users.users.default}
    MR3-warehouse.default.svc:
      type: micro.nodes.MessageRouter
      requirements:
        - {interaction: S3-warehouse.warehouse-rs.default}
    MR56-store.default.svc:
      type: micro.nodes.MessageRouter
      requirements:
        - {interaction: S5-e-commerce.store.default.deploy}
        - {interaction: S6-shop.store.default}
    MR8-catalogue-edge.default.svc:
      type: micro.nodes.MessageRouter
      requirements:
        - {interaction: S8-mysql-catalogue.catalogue.default.sts}

  relationship_templates:
    c:
      properties: { circuit_breaker: true }
      type: micro.relationships.InteractsWith
    cd:
      properties: { circuit_breaker: true, dynamic_discovery: true }
      type: micro.relationships.InteractsWith
    d:
      properties: { dynamic_discovery: true }
      type: micro.relationships.InteractsWith
    t:
      properties: { timeout: true }
      type: micro.relationships.InteractsWith
    tc:
      properties: { circuit_breaker: true, timeout: true }
      type: micro.relationships.InteractsWith
    tcd:
      properties: { circuit_breaker: true, dynamic_discovery: true, timeout: true }
      type: micro.relationships.InteractsWith
    td:
      properties: { dynamic_discovery: true, timeout: true }
      type: micro.relationships.InteractsWith

tosca_definitions_version: micro_tosca_yaml_1.1